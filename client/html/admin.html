<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width-device-width,initial-scale=1">
        <title>ITrack - The University of Adelaide Admin Page</title>
        <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='main.css') }}"> <!-- Reference to css for Flask compatibility -->
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
        <script defer src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>
        <script src="{{ url_for('static', filename='functions.js') }}"></script>
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.2.1/css/fontawesome.min.css">
        <meta name="viewport" content="width=device-width, initial-scale=1">
    </head>
    <body>
        <section id="nav-bar">
            <nav class="navbar fixed-top navbar-expand-sm navbar-light">
            <a class="navbar-brand" href="#"><img src="{{ url_for('static', filename='logo.png') }}"></a>
            <h1 class="criticalred">Admin</h1>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                <li class="nav-item">
                    <a class="nav-link" href="#">Home</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link active" href="admin.html">Admin</a>
                </li>
                <li class="nav-item dropdown">
                    <a href="#" class="nav-link dropdown-toggle" id="navbarDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">Collection</a>
                    <ul class="dropdown-menu" aria-labelledby="navbarDropdown">
                        <li><a href="#" class="dropdown-item">Mac</a></li>
                        <li><a href="#" class="dropdown-item">Windows</a></li>
                        <li><a href="#" class="dropdown-item">Tablets</a></li>
                        <li><a href="#" class="dropdown-item">Laptops</a></li>
                        <li><a href="#" class="dropdown-item">Other</a></li>
                    </ul>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#">Finance History</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#">Insurance Claims</a>
                </li>
                <li class a nav-item">
                    <a class="nav-link" href="#">Location</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#">Contact</a>
                </li>
                </ul>
            </div>
            </nav>
        </section>

        <main role="main">
            <section class="jumbotron text-centre">
                <div class="container">
                    <h1 class="jumbotron-heading">Welcome to ITrack Admin!</h1>
                    <p class="lead text-muted">Feel free to browse our collection of electronical devices to loan or purchase.</p>
                    <p>
                      <a href="#" class="btn btn-primary my-2">Loan a device</a>
                      <a href="#" class="btn btn-secondary my-2">Return a device</a>
                      <a href="{{ url_for('static', filename='newitem.html') }}" class="btn btn-primary my-2">Add a Device</a>
                    </p>
                  </div>
            </section>
            <section>
                <div class="container">
                    <h2>Available collections</h2>
                    <a><div onclick="togglediv('studLaptops')" class="collection">
                    <img class="collectionIcon" src="{{ url_for('static', filename='150laptops.png') }}">
                    <b>Student Laptops</b> 3 Items
                    </div></a>

                    <a><div onclick="togglediv('prints')" class="collection">
                        <img class="collectionIcon" src="{{ url_for('static', filename='150laptops.png') }}">
                        <b>Printers</b> 8 Items
                    </div></a>
                </div>
                <br>
                <div class="container">
                    <a href="#" id="viewAllButton" class="btn btn-primary my-2">View All</a>
                </div>
                <div id="databaseEntries">
                    <table id="entriesTable">
                        <thead>
                            <tr>
                                <th>Line Description</th>
                                <th>Line Journal ID</th>
                                <th>Line Number</th>
                                <th>Line Operator ID</th>
                                <th>Line Source ID</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Entries will be added here -->
                        </tbody>
                    </table>
                </div>                
                <br>
                <br>
                <br>
                <br>
                <div id="studLaptops" class="container collapse" style="display: none;">
                    <h2>Student Laptops:</h2>
                    <a><div onclick="togglediv('laptop1')" class="collection">
                        <img class="collectionIcon" src="{{ url_for('static', filename='150laptops.png') }}">
                        <b>M1 Macbook Air (2021)</b>
                        <p class="itemText">
                            <br>Loaned to: Jarvis Collins - a1826609
                            <div id="laptop1" style="display: none;">
                                <p class="itemText">
                                    Cost: $1,499.00
                                    <br>Manufacturer: Apple
                                    <br>Loaned Out: 21/03/22
                                    <br>Due Returned: 28/10/22
                                    <br>Location: On Student
                                </p>
                            </div>
                        </p>
                    </div></a>
                    <a><div onclick="togglediv('laptop2')" class="collection">
                        <img class="collectionIcon" src="{{ url_for('static', filename='150laptops.png') }}">
                        <b>Dell Latitude 3510</b>
                        <p class="itemText">
                            <br>Loaned to: Will Daniels - a5318008
                            <div id="laptop2" style="display: none;">
                                <p class="itemText">
                                    Cost: $1,739.39
                                    <br>Manufacturer: Dell Technologies
                                    <br>Loaned Out: 21/03/22
                                    <br>Due Returned: 28/10/22
                                    <br>Location: On Student
                                </p>
                            </div>
                        </p>
                    </div></a>
                </div>
                <div id="prints" class="container collapse" style="display: none;">
                    <h2>Printers:</h2>
                    <a><div onclick="togglediv('printer1')" class="collection">
                        <img class="collectionIcon" src="{{ url_for('static', filename='150laptops.png') }}">
                        <b>EcoTank ET-4850</b>
                        <p class="itemText">
                            <br>Loaned to: Teacher Name - a1111777
                            <div id="printer1" style="display: none;">
                                <p class="itemText">
                                    Cost: $629.00
                                    <br>Manufacturer: Epson
                                    <br>Loaned Out: 24/10/22
                                    <br>Due Returned: 24/10/25
                                    <br>Location: In 'Teacher Name's' Office
                                </p>
                            </div>
                        </p>
                    </div></a>
                </div>
            </section>
        </main>
        <script>
            // Function to load entries from Python script
            function loadEntries() {
                const databaseEntries = document.getElementById("databaseEntries");
                const viewAllButton = document.getElementById("viewAllButton");
                const entriesTable = document.getElementById("entriesTable");
                const tableBody = document.querySelector("#entriesTable tbody");

                // Event listener for the "View All" button
                viewAllButton.addEventListener("click", function () {
                    while (tableBody.firstChild) {
                        tableBody.removeChild(tableBody.firstChild);
                        }
                    entriesTable.style.display = "table"; // Display the table
                    // Make an AJAX request to fetch data from Flask route '/get_entries'
                    const xhr = new XMLHttpRequest();
                    xhr.open("GET", "/get_entries", true);

                    xhr.onreadystatechange = function () {
                        if (xhr.readyState === 4 && xhr.status === 200) {
                            const entries = JSON.parse(xhr.responseText);

                            // Display the entries in the databaseEntries div
                            //databaseEntries.innerHTML = "<pre>" + JSON.stringify(entries, null, 2) + "</pre>";
                            populateTable(entries);
                        }
                    };

                    xhr.send();
                });
            }
            // Function to populate the HTML table with JSON data
            function populateTable(entries) {
                const tableBody = document.querySelector("#entriesTable tbody");

                entries.forEach(entry => {
                    const row = tableBody.insertRow();
                    row.insertCell(0).textContent = entry.Line_Description;
                    row.insertCell(1).textContent = entry.Line_Journal_ID;
                    row.insertCell(2).textContent = entry.Line_Number;
                    row.insertCell(3).textContent = entry.Line_Operator_ID;
                    row.insertCell(4).textContent = entry.Line_Source_ID;
                });
            }
            // Call the loadEntries function when the document is ready
            document.addEventListener("DOMContentLoaded", loadEntries);
        </script>
            
    </body>
</html>
